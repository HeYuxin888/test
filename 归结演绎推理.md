[TOC]

# 归结演绎推理

归结演绎推理可分为三部分，首先是把谓词公式化为字句集，然后运用归结原理对子句集进行归结。然后是应用，一个是归结反演，再一个是运用归结反演开求解问题。

## 一、子句集

##### 1.子句和子句集

**定义3.11** 原子谓词公式及其否定统称为文字。

例如，$P(x)，Q(x)， ¬ P(x)， ¬ Q(x)$等都是文字。

**定义3.12** 任何文字的析取式称为子句。这里的谓词公式之间不能有合取，也不能有蕴含。

例如，$P(x) V Q(x)，P(x, f(x)) V Q(x, g(x))$都是子句。

**定义3.13** 不含任何文字的子句称为空子句。由于空子句不含有任何文字，也就不能被任何解释所满足，因此空子句是永假的，不可满足的。空子句一般被记为$NIL$。

**定义3.14** 由子句或空子句所构成的集合称为子句集。

##### 2.子句集的化简

在谓词逻辑中，任何一个谓词公式都可以通过应用等价关系及推理规则化成相应的子句集。其化简步骤如下:

（1）消去连接词“$→$”和“$ ↔$”

反复使用如下等价公式:
$$
P → Q ⇔ ¬P ∨ Q
$$

$$
P↔Q ⇔ (P ∧ Q) ∨ (¬ P ∧ ¬ Q)
$$

即可消去谓词公式中的连接词“→”和“     ”例如公式:
$$
(∀x)((∀ y)P(x, y) →(∀ y)(Q(x, y) → R(x,y)))
$$
经等价变化后为:
$$
(∀x)(¬(∀ y)P(x, y) ∨ (∀ y)(¬ Q(x, y) ∨ R(x,y)))
$$
（2）减少否定符号的辖域

反复使用双重否定率
$$
¬(¬ P) ⇔ P
$$
摩根定律
$$
¬(P ∧ Q) ⇔¬P ∨¬Q
$$

$$
¬(P ∨ Q) ⇔ ¬ P ∧ ¬ Q
$$

量词转换率
$$
¬(∀x)p(x) ⇔ (∃x)¬ P(x)
$$

$$
¬(∃x)p(x) ⇔ (∀x)¬ P(x)
$$

将每个否定符号”$¬$”移到仅靠谓词的位置，使得每个否定符号最多只作用于一个谓词上。

例如公式
$$
(∀x)((∀ y)P(x, y) →(∀ y)(Q(x, y) → R(x,y)))
$$
经等价变化后为
$$
(∀x)( (∃y) ¬ P(x, y) ∨¬(∃y)(Q(x, y) ∧ ¬R(x,y)))
$$
（3）对变元标准化

在一个量词的辖域内，把谓词公式中受该量词约束的变元全部用另外一个没有出现过的任意变元代替，使不同量词约束的变元有不同的名字。目的是消除辖域内的重名变元。

*注：辖域是指全称量词和存在量词后面的部分*

比如一班和二班都有张伟同学，我们可以称一班同学的为张伟，二班的同学为大张伟。

例如，上一步得到的式子
$$
(∀x)( (∃y) ¬ P(x, y) ∨¬(∃y)(Q(x, y) ∧ ¬R(x,y)))
$$
经变换后为
$$
(∀x)( (∃y) ¬ P(x, y) ∨¬(∃z)(Q(x, z) ∧ ¬R(x, z)))
$$
（4）化为前束范式

化为前束范式的方法：把所有量词都移到公式的左边，并且在移动时不能改变其相对顺序。由于第 3 步已对变元进行了标准化，每个量词都有自已的变元，这就消除了任何由变元引起冲突的可能，因此这种移动是可行的。

例如，上式
$$
(∀x)( (∃y) ¬ P(x, y) ∨¬(∃z)(Q(x, z) ∧ ¬R(x, z)))
$$
化为前束范式后为
$$
(∀x)(∃y)(∃z) (¬ P(x, y) ∨ (Q(x, z) ∧ ¬R(x, z)))
$$
（5）消去存在量词

消去存在量词时，需要区分以下两种情况:

若存在量词不出现在全称量词的辖域内(即它的左边没有全称量词)，只要用一个新的个体常量替换受该存在量词约束的变元，就可消去该存在量词。

若存在量词位于一个或多个全称量词的辖域内，例如
$$
(∀x_1)… (∀x_n) (∃y) P(x_1, x_2,…, x_n,y)
$$
则需要用$Skolem$函数 $f(x_1, x_2,…, x_n) $替换受该存在量词约束的变元$y$，然后再消去该存在量词。例如，上步所得公式中存在量词$(∃y)$和$(∃z)$都位于$(∀ x)$的辖域内，因此都需要用$Skolem$ 函数来替换。设替换$y$和$z$的$Skolem$ 函数分别是$f(x)$和$g(x)$，则替换后的式子为
$$
(∀x) (¬ P(x, f(x)) ∨ (Q(x, g(x)) ∧ ¬R(x, g(x))))
$$
（6）化为skolem标准形

$Skolem$标准形的一般形式为
$$
(∀x_1)… (∀x_n) M(x_1, x_2,…, x_n)
$$
 其中，$M(x_1, x_2,…, x_n)$是$Skolem $标准形的母式，它由子句的合取所构成。把谓词公式化为$Skolem$标准形需要使用以下等价关系
$$
P ∨ (Q ∧ R) ⇔ (P ∨ Q) ∧ (P ∨ R)
$$
例如，前面的公式
$$
(∀x) (¬ P(x, f(x)) ∨ (Q(x, g(x)) ∧ ¬R(x, g(x))))
$$
化为 $Skolem$标准形后为
$$
(∀x) ((¬ P(x, f(x)) ∨ (Q(x, g(x)) ∧ (¬ P(x, f(x))∨¬R(x, g(x))))
$$
（7）消去全称量词

由于母式中的全部变元均受全称量词的约束，并且全称量词的次序已无关紧要，因此可以省掉全称量词。 但剩下的母式，仍假设其变元是被全称量词量化的。

*注：这里的“省掉”，不是去掉。比如正数前面的正号总是会被省略，但意义不变。*

例如,上式略去全称量词后为
$$
(¬ P(x, f(x)) ∨ (Q(x, g(x)) ∧ (¬ P(x, f(x))∨¬R(x, g(x))))
$$
（8）消去合取词

在母式中消去所有合取词，把母式用子句集的形式表示出来。 其中，子句集中的每一个元素都是一个子句。

例如,上式的子句集中包含以下两个子句
$$
¬ P(x, f(x)) ∨ Q(x, g(x))
$$

$$
¬ P(x, f(x)) ∨¬R(x, g(x))
$$

（9）更换变量名称

对子句集中的某些变量重新命名，使任意两个子句中不出现相同的变量名。由于每一个子句都对应着母式中的一个合取元，并且所有变元都是由全称量词量化的，因此任意两个不同子句的变量之间实际上不存在任何关系。 这样，更换变量名是不会影响公式的真值的。

例如，对前面的公式，可把第二个子句集中的变元名$x$更换为$y$，得到如下子句集
$$
¬ P(x, f(x)) ∨ Q(x, g(x))
$$

$$
¬ P(y, f(y)) ∨¬R(y, g(y))
$$

##### 3.子句集的应用

在上述化简过程中，由于在消去存在量词时所用的$ Skolem$ 函数可以不同，因此化简后的标准子句集是不唯一的。

这样，当原谓词公式为非永假时，它与其标准子句集并不等价。但当原谓词公式为永假(或不可满足)时，其标准子句集则一定是永假的，即$Skolem$化并不影响原谓词公式的永假性。

这个结论很重要，是归结原理的主要依据，可用定理的形式来描述。

**定理3.2** 设有谓词公式F，其标准子句集为S，则F为不可满足的充要条件是S不可满足的。

## 二、鲁滨逊归结原理

##### 1.基本思想

由谓词公式转化为子句集的方法可以知道，在子句集中子句之间是合取关系。其中，只要有一个子句为不可满足，则整个子句集就是不可满足的，另外，前面已经指出空子句是不可满足的。因此，一个子句集中如果包含有空子句，则此子句集就一定是不可满足的。

鲁滨逊归结原理就是基于上述认识提出来的，其中基本思相是：首先把欲证明问题的结论否定，并加入子句集，得到一个扩充的子句集$S’$，然后设法检验子句集$S’$是否名含有空子句，若含有空子句，则表明S’是不可满足的；若不含有空子句，则继续使用归结法，在子句集中选择合适的子句进行归结，直至导出空句子或不能继续归结为止。 鲁滨逊归结原理可分为命题逻辑归结原理和谓词逻辑归结原理。

##### 2.命题归结逻辑归结

归结推理的核心是求两个子句的归结式，因此需要先讨论归结式的定义和性质，然后再讨论命题逻辑的归结过程。

（1）归结式的定义及性质

**定义3.15** 若$P$是原子谓词公式，则称$P$与$¬ P$为互补文字。

**定义3.16** 设$C_1$和$C_2$是子句集中的任意两个子句，如果$C_1$中的文字$L_1$与$C_2$中的文字$L_2$互补，那么可从$C_1$和$C_2$中分别消去$L_1$和$L_2$，并将$C_1$和$C_2$中余下的部分按析取关系构成一个新的子句$C_{12}$，则称这一过程为归结，称$C_{12}$为$C_1$和$C_2$的归结式，称$C_1$和$C_2$为$C_{12}$的亲本子句。

<img src="../AppData/Roaming/Typora/typora-user-images/image-20240928192431831.png" style="zoom: 50%;" />

**例3.4** 设$C_1 = ¬Q， C_2=Q，$求$C_1$和$C_2$的归结式$C_{12}$

解:这里$L_1 = ¬Q， L_2 =Q，$通过归结可以得到$C_{12}=NIL$

如果改变归结顺序，同样可以得到相同的结果，即其归结过程是不唯一的。

**定理3.3** 归结式$C_{12}$是其亲本子句C_1和C_2的逻辑结论。

上述定理是归结原理中的一个重要定理，由它可得到以下两个推论:

**推论1:**设$C_1$和$C_2$是子句集$ S $中的两个子句，$C_{12}$是$C_1$和$C_2$的归结式，若用$C_{12}$代替$C_1$和$C_2$后得到新的子句集$S_1$，则由$S_1$的不可满足性可以推出原子句集 $S$的不可满足性。即:
$$
S_1的不可满足性⇒S_ 的不可满足性
$$
**推论2:**设$C_1$和$C_2$是子句集 $S$ 中的两个子句， $C_{12}$是$C_1$和$C_2$的归结式，若$C_{12}$加入原子句集$S$，得到新的子句集$S_2$，则$S$与$S_2$的不可满足性是等价的。即:
$$
S_2的不可满足性⇔S_ 的不可满足性
$$
上述两个推论说明，为证明子句集$S$的不可满足性，只要对其中可进行归结得子句进行归结，并把归结式加入到子句集$S$中，或者用归结式代替他的亲本子句，然后对新的子句集证明其不可满足性就可以了。

如果经归结能得到空子句，根据空子句的不可满足性，即可得到原子句集$S$是不可满足的结论。

在命题逻辑中，对不可满足的子句集$S$，其归结原理是完备的。这种不可满足性可用如下定理描述:

**定理3.4**  子句集$S$是不可满足的，当且仅当存在一个从$S$到空子句的归结过程。

（2）命题逻辑的归结反演

归结原理：假设F为已知前提，$G$为欲证明的结论，归结原理把证明$G$为$F$的逻辑结论转化为证明$F∧¬G$为不可满足，再根据**定理3.2**，在不可满足的意义上，公式集$F∧¬G$与其子句集是等价的，即把公式集上的不可满足转化为子句集上的不可满足。应用归结原理证明定理的过程称为归结反演。

在命题逻辑中，已知$F$，证明$G$为真的归结反演过程如下:

- 否定目标公式$G$，得$¬G$;

- 把$¬ G$并入到公式集$F$中，得到${ F, ¬G}$;
- 把${F, ¬G}$化为子句集$S$;
- 应用归结原理对子句集$S$中的子句进行归结，并把每次得到的归结式并入$S$中，如此反复进行，若出现空子句，则停止归结，此时就证明了$G$为真。

**例3.5** 设已知的公式集为${ P, (P ∧ Q) → R, T → Q, T }$，求证结论$R$。

解：$$\{ P, ¬ P ∨¬ Q ∨ R, ¬ T ∨ Q, T,  ¬R          \}$$归结后为$NIL$,知$R$为真。

##### 3.谓词逻辑的归结

在谓词逻辑中，由于子句集中的谓词一般都含有变元，因此不能像命题逻辑那样直接消去互补文字。而需要先用一个最一般合一置换对变元进行代换，然后才能进行归结。 

谓词逻辑中的归结式可用如下定义来描述:

**定义3.17** 设$C_1$和$C_2$是两个没有公共变元的子句，$L_1$和$L_2$分别是$C_1$和$C_2$中的文字。如果$L_1$和$L_2$存在最一般合一$σ$，则称$C_{12} = ( {C_1σ} - {L_1σ} ) ∪ ( {C_2σ} - {L_2σ} ) $为$C_1$和$C_2$的二元归结式，而$L_1$和$L_2$为归结式上的文字。

**例3.6** 设$C_1 =P(x) ∨ Q(a), C_2=¬P(b) ∨ R(x),$ 求$C_{12}$. 

解：首先对$C_2$标准化，将变量x用y替换。

$\sigma=\{b\mid x\}$

$C_1 =P(b) ∨ Q(a)$

$C_{12} =Q(a)∨ R(y)$

**例3.7** 设$C_1 =P(x) ∨ P(f(a)) ∨ Q(x), C_2=¬P(y) ∨ R(b)$, 求$C_{12}$. 

解：如果某子句内部含有可以合一的文字，先进行合一。

$\sigma=\{f(a)\mid x\}$

$C_1 =P(f(a)) ∨ Q(f(a))$

$\sigma_2=\{f(a)\mid y\}$

$C_2 =¬P(f(a)) ∨ R(b)$

$C_{12} =Q(f(a)) ∨ R(b)$

我们把$C_1σ$称为$C_1$的因子。一般来说，若子句 $C$ 中有两个或两个以上的文字具有最一般合一$σ$，则称$C_ σ$为子句$C$ 的因子。 如果$C_ σ$是一个单文字，则称它为$C$ 的单元因子。

应用因子概念,可对谓词逻辑中的归结原理给出如下定义:

**定义3.18** 若$C_1$和$C_2$是无公共变元的子句，则

(1)$ C_1$和$C_2$的二元归结式;

(2) $C_1$和$C_2$的因子$C_2σ_2 $的二元归结式;

(3) $C_1$的因子$C_1σ1$和$C_2$的二元归结式;

(4) $C_1$的因子$C_1σ_1$和$C_2$的因子$C_2σ_2$的二元归结结式。

这四种二元归结式都是子句$C_1$和$C_2$的二元归结式，记为$C_{12}。

对谓词逻辑，**定理3.3**仍然适用，即归结式$C_{12}$是其亲本子句$C_1$和$C_2$的逻辑结论。用归结式取代它在子句集$S$中的亲本子句，所得到的子句集仍然保持着原子句集$S$的不可满足性。

此外，对谓词逻辑**定理3.4**也仍然适用，即从不可满足的意义上说，一阶谓词逻辑的归结原理也是完备的。

谓词逻辑的归结反演过程与命题逻辑的归结反演过程相比，其步骤基本相同，但每步的处理对象不同。例如，在第三步化简子句集时，谓词逻辑需要把由谓词构成的公式集化为子句集；在第四步按归结原理进行归结时，谓词逻辑的归结原理需要考虑两个亲本子句的最一般合一。
